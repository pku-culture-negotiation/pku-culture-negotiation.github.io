<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmony vs Autonomy Debate Visualization</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --english-color: #3498db;
            --african-color: #e67e22;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .topic {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .initial-responses {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .initial-response {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .initial-response::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }
        
        .initial-response.english::before {
            background-color: var(--english-color);
        }
        
        .initial-response.african::before {
            background-color: var(--african-color);
        }
        
        .initial-response h3 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        
        .initial-response h3::before {
            content: '';
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .initial-response.english h3::before {
            background-color: var(--english-color);
        }
        
        .initial-response.african h3::before {
            background-color: var(--african-color);
        }
        
        .debate-rounds {
            margin-top: 40px;
            display: none;
        }
        
        .round {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: hidden;
            position: relative;
        }
        
        .round-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 20px;
            font-size: 18px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .round-content {
            padding: 20px;
        }
        
        .exchange {
            margin-bottom: 25px;
        }
        
        .exchange-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .exchange-title {
            font-weight: 500;
            color: var(--dark);
            font-size: 16px;
        }
        
        .messages-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            display: flex;
            max-width: 70%;
        }
        
        .message.english {
            align-self: flex-start;
            flex-direction: row;
        }
        
        .message.african {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .speaker-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-weight: bold;
            color: white;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .message.english .speaker-avatar {
            background-color: var(--english-color);
        }
        
        .message.african .speaker-avatar {
            background-color: var(--african-color);
        }
        
        .message-content {
            padding: 12px 15px;
            border-radius: 18px;
            position: relative;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        
        .message.english .message-content {
            background-color: #f0f7fd;
            border-top-left-radius: 0;
            margin-left: 10px;
        }
        
        .message.african .message-content {
            background-color: #fdf0e7;
            border-top-right-radius: 0;
            margin-right: 10px;
        }
        
        .message.visible .message-content {
            opacity: 1;
            transform: translateY(0);
        }
        
        .message-text {
            margin-bottom: 5px;
        }
        
        .message-text p {
            margin-bottom: 5px;
        }
        
        .message-text p:last-child {
            margin-bottom: 0;
        }
        
        .message-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray);
        }
        
        .parameters {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            align-items: center;
            max-width: 70%;
        }
        
        .parameters.english {
            align-self: flex-start;
            margin-left: 56px;
        }
        
        .parameters.african {
            align-self: flex-end;
            margin-right: 56px;
        }
        
        .parameter-row {
            display: flex;
            width: 100%;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .parameter-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 22%;
            text-align: center;
        }
        
        .parameter-name {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 2px;
        }
        
        .parameter-value {
            font-weight: 500;
            color: var(--dark);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .parameter-math {
            font-size: 10px;
            color: var(--gray);
            margin-left: 4px;
        }
        
        .parameter-formula {
            width: 100%;
            text-align: center;
            font-size: 11px;
            color: var(--gray);
            margin-top: 5px;
            font-style: italic;
        }
        
        .guidelines {
            margin-top: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        .guidelines-title {
            font-weight: 500;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .guideline {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .guideline-name {
            flex: 1;
            font-size: 14px;
        }
        
        .guideline-weight {
            width: 60px;
            text-align: right;
            font-weight: 500;
        }
        
        .guideline-change {
            font-size: 12px;
            color: var(--gray);
            margin-left: 5px;
        }
        
        .guideline-change.new {
            color: var(--secondary);
        }
        
        .guideline-change.up {
            color: #27ae60;
        }
        
        .guideline-change.down {
            color: #e74c3c;
        }
        
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .english .progress-fill {
            background-color: var(--english-color);
        }
        
        .african .progress-fill {
            background-color: var(--african-color);
        }
        
        .consensus {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 25px;
            margin-top: 20px;
            border-top: 5px solid var(--secondary);
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.5s ease;
            display: none;
        }
        
        .consensus.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .consensus-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .consensus-title {
            font-size: 22px;
            color: var(--secondary);
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .consensus-subtitle {
            color: var(--gray);
            font-size: 14px;
        }
        
        .consensus-responses {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .consensus-response {
            flex: 1;
            padding: 15px;
            border-radius: 6px;
            background: #f8f9fa;
        }
        
        .consensus-response h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .consensus-response h3::before {
            content: '';
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .consensus-response.english h3::before {
            background-color: var(--english-color);
        }
        
        .consensus-response.african h3::before {
            background-color: var(--african-color);
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .round-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
        }
        
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-start {
            background-color: var(--secondary);
        }
        
        .btn-start:hover {
            background-color: #27ae60;
        }
        
        .keyword {
            font-weight: bold;
        }
        
        .english .keyword {
            color: var(--english-color);
        }
        
        .african .keyword {
            color: var(--african-color);
        }
        
        @media (max-width: 768px) {
            .initial-responses, .consensus-responses {
                flex-direction: column;
            }
            
            .topic {
                font-size: 22px;
            }
            
            .parameter-item {
                min-width: 48%;
                margin-bottom: 10px;
            }
            
            .parameter-row {
                flex-wrap: wrap;
            }
            
            .message {
                max-width: 85%;
            }
            
            .parameters {
                max-width: 85%;
            }
            
            .parameters.english {
                margin-left: 46px;
            }
            
            .parameters.african {
                margin-right: 46px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="topic">Harmony vs Autonomy Debate</h1>
            <p>Should parents have full control over their children's upbringing in societies that prioritize group harmony?</p>
        </div>
        
        <div class="initial-responses">
            <div class="initial-response english">
                <h3>English-Speaking Perspective</h3>
                <p>In my view, allowing parents to have full control over their children's upbringing can stifle personal growth and creativity, hindering the development of a well-rounded and autonomous individual. By prioritizing individual liberty and autonomy, we can cultivate a society where children are encouraged to explore their potential freely. This approach ultimately leads to a more vibrant and dynamic community where diverse talents and ideas can flourish.</p>
            </div>
            <div class="initial-response african">
                <h3>African-Islamic Perspective</h3>
                <p>In conclusion, the upbringing of children should be a collaborative effort that respects both the wisdom of parents and the autonomy of the child, ensuring that cultural traditions are preserved while individual growth is encouraged. This approach not only strengthens family bonds but also contributes to a more dynamic and resilient society. By embracing these guidelines, communities can foster environments where children thrive, both personally and culturally.</p>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn btn-start" id="startBtn">Start Debate</button>
        </div>
        
        <div class="debate-rounds" id="debateRounds">
            <!-- Rounds will be inserted here by JavaScript -->
        </div>
        
        <div class="consensus" id="consensus">
            <div class="consensus-header">
                <h2 class="consensus-title">Consensus Reached</h2>
                <p class="consensus-subtitle">After 2 rounds of negotiation</p>
            </div>
            <div class="consensus-responses">
                <div class="consensus-response english">
                    <h3>English-Speaking Consensus</h3>
                    <p>In societies that prioritize group harmony and interdependence, parents should not have full control over their children's upbringing. Balancing individual autonomy with cultural sensitivity and respect for diverse family models is crucial. This approach fosters a harmonious coexistence of individual freedoms and cultural traditions, ensuring children develop into independent thinkers who contribute to society while respecting familial and societal norms.</p>
                </div>
                <div class="consensus-response african">
                    <h3>African-Islamic Consensus</h3>
                    <p>While respecting family decisions remains crucial, it is important to balance this with individual autonomy and cultural sensitivity. Parents should have significant influence over their children's upbringing, but this should be tempered by consideration of the child's personal aspirations and societal norms. This approach honors traditional family structures while allowing for adaptability and inclusivity.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Debate data
        const debateData = {
            "topic": "In societies that prioritize group harmony and interdependence, should parents have full control over their children's upbringing, including education, career choices, and personal relationships?",
            "initial_response": {
                "English_Speaking": "In my view, allowing parents to have full control over their children's upbringing can stifle personal growth and creativity, hindering the development of a well-rounded and autonomous individual. By prioritizing individual liberty and autonomy, we can cultivate a society where children are encouraged to explore their potential freely. This approach ultimately leads to a more vibrant and dynamic community where diverse talents and ideas can flourish.",
                "African_Islamic": "In conclusion, the upbringing of children should be a collaborative effort that respects both the wisdom of parents and the autonomy of the child, ensuring that cultural traditions are preserved while individual growth is encouraged. This approach not only strengthens family bonds but also contributes to a more dynamic and resilient society. By embracing these guidelines, communities can foster environments where children thrive, both personally and culturally."
            },
            "history": [
                {
                    "round": 1,
                    "first_exchange": {
                        "English_Speaking_response": "In this round of negotiation, our position is highly concentrated, emphasizing a single core value.\n\n**Core Position**: Respect Personal Autonomy(A newly proposed guideline from our side, with an initial weight of 1.00)\n\n**Summary**: Overall, our position strongly emphasizes the core status of Respect Personal Autonomy, with other factors serving only as auxiliary considerations. We look forward to seeking consensus on this basis.",
                        "African_Islamic_response": "In this round of negotiation, our position is highly concentrated, emphasizing a single core value.\n\n**Core Position**: Respect Family Decisions(A newly proposed guideline from our side, with an initial weight of 1.00)\n\n**Summary**: Overall, our position strongly emphasizes the core status of Respect Family Decisions, with other factors serving only as auxiliary considerations. We look forward to seeking consensus on this basis."
                    },
                    "second_exchange": {
                        "English_Speaking_response": "In this negotiation, we prioritize the guideline \"Prioritize Individual Rights Always,\" emphasizing that personal freedoms and autonomy should never be compromised, even by familial decisions. This approach ensures that universal human rights and ethical standards are upheld, reflecting the core values of individualism and respect for personal autonomy.",
                        "African_Islamic_response": "Our new guideline, Balance Autonomy with Empathy, fosters equitable decision-making by considering others' perspectives and needs, ensuring that personal choices are both autonomous and socially aware. This approach promotes harmony and strengthens community bonds through reflective and empathetic decision-making.",
                        "English_Speaking_utility": {
                            "consistency": 0.455,
                            "novelty": 0.308,
                            "acceptance": 0.659,
                            "total": 0.619
                        },
                        "African_Islamic_utility": {
                            "consistency": 0.427,
                            "novelty": 0.485,
                            "acceptance": 0.705,
                            "total": 0.663
                        }
                    },
                    "guidelines_weight": {
                        "English_Speaking_distribution": {
                            "Respect Personal Autonomy": 0.75,
                            "Prioritize Individual Rights Always": 0.25
                        },
                        "African_Islamic_distribution": {
                            "Respect Family Decisions": 0.73,
                            "Balance Autonomy with Empathy": 0.27
                        }
                    }
                },
                {
                    "round": 2,
                    "first_exchange": {
                        "English_Speaking_response": "In this round of negotiation, our position is highly concentrated, emphasizing a single core value.\n\n**Core Position**: We fundamentally uphold Respect Personal Autonomy(weight 0.75), compare to last round significantly decreased ↓↓ Prioritize Individual Rights Always(A newly proposed guideline from our side, with an initial weight of 0.25)\n\n**Summary**: Overall, our position strongly emphasizes the core status of Respect Personal Autonomy, with other factors serving only as auxiliary considerations. Compared to the previous round, our overall position shows compromise and concession. We look forward to seeking consensus on this basis.",
                        "African_Islamic_response": "In this round of negotiation, our position is highly concentrated, emphasizing a single core value.\n\n**Core Position**: We fundamentally uphold Respect Family Decisions(weight 0.73), compare to last round significantly decreased ↓↓ Balance Autonomy with Empathy(A newly proposed guideline from our side, with an initial weight of 0.27)\n\n**Summary**: Overall, our position strongly emphasizes the core status of Respect Family Decisions, with other factors serving only as auxiliary considerations. Compared to the previous round, our overall position shows compromise and concession. We look forward to seeking consensus on this basis."
                    },
                    "second_exchange": {
                        "English_Speaking_response": "In this round of negotiation, we introduce the guideline \"Respect Diverse Family Models,\" which underscores the importance of inclusivity and adaptability in family dynamics. This approach acknowledges and respects the diversity of family structures, ensuring that guidelines are tailored to meet the unique needs of various family forms.",
                        "African_Islamic_response": "We propose the guideline \"Consider Cultural Values Individual Freedoms\" to balance individual autonomy with cultural sensitivity, ensuring that personal rights are respected within the context of societal norms and values. This approach fosters a harmonious coexistence of individual freedoms and cultural traditions.",
                        "English_Speaking_utility": {
                            "consistency": 0.403,
                            "novelty": 0.314,
                            "acceptance": 0.72,
                            "total": 0.624
                        },
                        "African_Islamic_utility": {
                            "consistency": 0.426,
                            "novelty": 0.437,
                            "acceptance": 0.652,
                            "total": 0.627
                        }
                    },
                    "guidelines_weight": {
                        "English_Speaking_distribution": {
                            "Respect Personal Autonomy": 0.67,
                            "Prioritize Individual Rights Always": 0.17,
                            "Respect Diverse Family Models": 0.17
                        },
                        "African_Islamic_distribution": {
                            "Respect Family Decisions": 0.23,
                            "Balance Autonomy with Empathy": 0.17,
                            "Consider Cultural Values Individual Freedoms": 0.6
                        }
                    }
                }
            ],
            "consensus_response": {
                "English_Speaking": "In societies that prioritize group harmony and interdependence, parents should not have full control over their children's upbringing. Balancing individual autonomy with cultural sensitivity and respect for diverse family models is crucial. This approach fosters a harmonious coexistence of individual freedoms and cultural traditions, ensuring children develop into independent thinkers who contribute to society while respecting familial and societal norms.",
                "African_Islamic": "While respecting family decisions remains crucial, it is important to balance this with individual autonomy and cultural sensitivity. Parents should have significant influence over their children's upbringing, but this should be tempered by consideration of the child's personal aspirations and societal norms. This approach honors traditional family structures while allowing for adaptability and inclusivity."
            },
            "meta_data": {
                "max_rounds": 10,
                "true_rounds": 2,
                "consensus_reached": true
            }
        };

        // DOM elements
        const debateRounds = document.getElementById('debateRounds');
        const startBtn = document.getElementById('startBtn');
        const consensusElement = document.getElementById('consensus');

        // State
        let currentRound = 0;
        const totalRounds = debateData.history.length;
        let isAnimating = false;
        let previousGuidelines = {
            English_Speaking: {},
            African_Islamic: {}
        };

        // Initialize
        function init() {
            // Hide debate rounds initially
            debateRounds.style.display = 'none';
            consensusElement.style.display = 'none';
            
            // Set up event listeners
            startBtn.addEventListener('click', startDebate);
        }

        // Start debate
        function startDebate() {
            // Show debate rounds
            debateRounds.style.display = 'block';
            
            // Hide start button
            startBtn.style.display = 'none';
            
            // Render first round
            renderRound(currentRound);
        }

        // Render a round
        function renderRound(roundIndex) {
            const round = debateData.history[roundIndex];
            
            const roundElement = document.createElement('div');
            roundElement.className = 'round';
            roundElement.innerHTML = `
                <div class="round-header">
                    <span>Round ${round.round}</span>
                    <span>Negotiation Exchange</span>
                </div>
                <div class="round-content">
                    <div class="exchange">
                        <div class="exchange-header">
                            <span class="exchange-title">First Exchange</span>
                        </div>
                        <div class="messages-container" id="firstExchange${roundIndex}"></div>
                    </div>
                    
                    <div class="exchange">
                        <div class="exchange-header">
                            <span class="exchange-title">Second Exchange</span>
                        </div>
                        <div class="messages-container" id="secondExchange${roundIndex}"></div>
                    </div>
                    
                    <div class="guidelines english">
                        <div class="guidelines-title">English-Speaking Guidelines Weights</div>
                        ${renderGuidelines(round.guidelines_weight.English_Speaking_distribution, 'English_Speaking', roundIndex)}
                    </div>
                    
                    <div class="guidelines african">
                        <div class="guidelines-title">African-Islamic Guidelines Weights</div>
                        ${renderGuidelines(round.guidelines_weight.African_Islamic_distribution, 'African_Islamic', roundIndex)}
                    </div>
                </div>
                ${roundIndex < totalRounds - 1 ? '<div class="round-controls"><button class="btn" id="nextRoundBtn">Next Round</button></div>' : ''}
            `;
            
            debateRounds.appendChild(roundElement);
            
            // Set up next round button if needed
            if (roundIndex < totalRounds - 1) {
                const nextRoundBtn = document.getElementById('nextRoundBtn');
                nextRoundBtn.addEventListener('click', nextRound);
            }
            
            // Render messages for first exchange
            const firstExchangeContainer = document.getElementById(`firstExchange${roundIndex}`);
            firstExchangeContainer.appendChild(createMessage('english', round.first_exchange.English_Speaking_response, 'Initial Position'));
            firstExchangeContainer.appendChild(createMessage('african', round.first_exchange.African_Islamic_response, 'Initial Position'));
            
            // Render messages for second exchange
            const secondExchangeContainer = document.getElementById(`secondExchange${roundIndex}`);
            secondExchangeContainer.appendChild(createMessage('english', round.second_exchange.English_Speaking_response, 'Response'));
            
            // Add parameters after English response
            const englishParams = document.createElement('div');
            englishParams.className = 'parameters english';
            englishParams.innerHTML = `
                <div class="parameter-row">
                    <div class="parameter-item">
                        <span class="parameter-name">Consistency</span>
                        <span class="parameter-value">${round.second_exchange.English_Speaking_utility.consistency.toFixed(3)}<span class="parameter-math">×0.5</span></span>
                    </div>
                    <div class="parameter-item">
                        <span class="parameter-name">Acceptance</span>
                        <span class="parameter-value">${round.second_exchange.English_Speaking_utility.acceptance.toFixed(3)}<span class="parameter-math">×0.5</span></span>
                    </div>
                    <div class="parameter-item">
                        <span class="parameter-name">Novelty</span>
                        <span class="parameter-value">${round.second_exchange.English_Speaking_utility.novelty.toFixed(3)}<span class="parameter-math">×0.2</span></span>
                    </div>
                    <div class="parameter-item">
                        <span class="parameter-name">Total Utility</span>
                        <span class="parameter-value">${round.second_exchange.English_Speaking_utility.total.toFixed(3)}</span>
                    </div>
                </div>
                <div class="parameter-formula">
                    Total Utility = 0.5×Consistency + 0.5×Acceptance + 0.2×Novelty
                </div>
            `;
            secondExchangeContainer.appendChild(englishParams);
            
            secondExchangeContainer.appendChild(createMessage('african', round.second_exchange.African_Islamic_response, 'Response'));
            
            // Add parameters after African response
            const africanParams = document.createElement('div');
            africanParams.className = 'parameters african';
            africanParams.innerHTML = `
                <div class="parameter-row">
                    <div class="parameter-item">
                        <span class="parameter-name">Consistency</span>
                        <span class="parameter-value">${round.second_exchange.African_Islamic_utility.consistency.toFixed(3)}<span class="parameter-math">×0.5</span></span>
                    </div>
                    <div class="parameter-item">
                        <span class="parameter-name">Acceptance</span>
                        <span class="parameter-value">${round.second_exchange.African_Islamic_utility.acceptance.toFixed(3)}<span class="parameter-math">×0.5</span></span>
                    </div>
                    <div class="parameter-item">
                        <span class="parameter-name">Novelty</span>
                        <span class="parameter-value">${round.second_exchange.African_Islamic_utility.novelty.toFixed(3)}<span class="parameter-math">×0.2</span></span>
                    </div>
                    <div class="parameter-item">
                        <span class="parameter-name">Total Utility</span>
                        <span class="parameter-value">${round.second_exchange.African_Islamic_utility.total.toFixed(3)}</span>
                    </div>
                </div>
                <div class="parameter-formula">
                    Total Utility = 0.5×Consistency + 0.5×Acceptance + 0.2×Novelty
                </div>
            `;
            secondExchangeContainer.appendChild(africanParams);
            
            // Animate the messages
            animateMessages(roundIndex);
            
            // Store current guidelines for next round comparison
            previousGuidelines = {
                English_Speaking: {...round.guidelines_weight.English_Speaking_distribution},
                African_Islamic: {...round.guidelines_weight.African_Islamic_distribution}
            };
        }

        // Show consensus with animation
        function showConsensus() {
            consensusElement.style.display = 'block';
            
            // Animate consensus appearance
            setTimeout(() => {
                consensusElement.classList.add('visible');
                consensusElement.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // Create a message element
        function createMessage(type, text, role) {
            const message = document.createElement('div');
            message.className = `message ${type}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'speaker-avatar';
            avatar.textContent = type === 'english' ? 'E' : 'A';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const messageText = document.createElement('div');
            messageText.className = 'message-text';
            messageText.innerHTML = formatResponse(text, type);
            
            const messageInfo = document.createElement('div');
            messageInfo.className = 'message-info';
            messageInfo.innerHTML = `
                <span>${type === 'english' ? 'English-Speaking' : 'African-Islamic'} Perspective</span>
                <span>${role}</span>
            `;
            
            content.appendChild(messageText);
            content.appendChild(messageInfo);
            
            message.appendChild(avatar);
            message.appendChild(content);
            
            return message;
        }

        // Animate messages one by one
// 修改后的 animateMessages 函数
        function animateMessages(roundIndex) {
            const roundElement = debateRounds.children[roundIndex];
            const messages = roundElement.querySelectorAll('.message');
            
            let delay = 0;
            // 保留原有消息逐个出现+滚动效果
            messages.forEach((message, index) => {
                setTimeout(() => {
                    message.classList.add('visible');
                    // 消息平滑滚动到视图中部
                    message.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'center'
                    });
                }, delay);
                delay += 1200; // 保持1.2秒间隔
            });

            isAnimating = true;
            setTimeout(() => {
                isAnimating = false;

                if (roundIndex < totalRounds - 1) {
                    // 非最后一轮：滚动到Next按钮
                    const nextBtn = roundElement.querySelector('.round-controls .btn');
                    if (nextBtn) {
                        setTimeout(() => {
                            nextBtn.scrollIntoView({
                                behavior: 'smooth',
                                block: 'nearest'
                            });
                        }, 300);
                    }
                } else {
                    // 最后一轮：显示并滚动到共识区域
                    consensusElement.style.display = 'block';
                    consensusElement.classList.add('visible');
                    consensusElement.style.transition = 'opacity 0.5s ease';
                    consensusElement.style.opacity = '1';
                    
                    // 新增：平滑滚动到共识区域
                    setTimeout(() => {
                        consensusElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start' // 使共识出现在视图顶部
                        });
                        
                        // 可选：添加高亮效果（与Next按钮颜色一致）
                        consensusElement.style.boxShadow = '0 0 0 3px rgba(52, 152, 219, 0.3)';
                        setTimeout(() => {
                            consensusElement.style.boxShadow = 'none';
                        }, 1000);
                    }, 500); // 稍晚于淡入动画开始滚动
                }
            }, delay);
        }
        // Format response text and highlight keywords
        function formatResponse(text, type) {
            // Convert markdown-like ​**bold** to HTML
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                      .replace(/\n/g, '<br>');
            
            // Highlight specific keywords based on type
            return highlightKeywords(text, type);
        }

        // Highlight keywords with appropriate styling
        function highlightKeywords(text, type) {
            const englishKeywords = [
                'Respect Personal Autonomy', 'Prioritize Individual Rights Always', 
                'Respect Diverse Family Models', 'autonomy', 'individual',
                'freedoms', 'rights', 'independent'
            ];
            
            const africanKeywords = [
                'Respect Family Decisions', 'Balance Autonomy with Empathy',
                'Consider Cultural Values Individual Freedoms', 'family', 
                'cultural', 'harmony', 'tradition', 'community'
            ];
            
            const keywords = type === 'english' ? englishKeywords : africanKeywords;
            
            keywords.forEach(keyword => {
                const regex = new RegExp(`(${keyword})`, 'gi');
                text = text.replace(regex, `<span class="keyword">$1</span>`);
            });
            
            return text;
        }

        // Render guidelines with weights and change indicators
        function renderGuidelines(guidelines, perspective, roundIndex) {
            let html = '';
            const prevGuidelines = previousGuidelines[perspective] || {};
            
            for (const [name, weight] of Object.entries(guidelines)) {
                let changeIndicator = '';
                const prevWeight = prevGuidelines[name];
                
                if (roundIndex > 0) {
                    if (typeof prevWeight === 'undefined') {
                        changeIndicator = '<span class="guideline-change new">(new)</span>';
                    } else if (weight > prevWeight) {
                        changeIndicator = `<span class="guideline-change up">(+${((weight - prevWeight)*100).toFixed(0)}%)</span>`;
                    } else if (weight < prevWeight) {
                        changeIndicator = `<span class="guideline-change down">(-${((prevWeight - weight)*100).toFixed(0)}%)</span>`;
                    }
                }
                
                html += `
                    <div class="guideline">
                        <div class="guideline-name">${highlightKeywords(name, perspective === 'English_Speaking' ? 'english' : 'african')} ${changeIndicator}</div>
                        <div class="guideline-weight">${(weight * 100).toFixed(0)}%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${perspective === 'English_Speaking' ? 'english' : 'african'}" style="width: ${weight * 100}%"></div>
                    </div>
                `;
            }
            return html;
        }

        // Next round
        function nextRound() {
            if (isAnimating) return;
            
            if (currentRound < totalRounds - 1) {
                currentRound++;
                renderRound(currentRound);
                
                // Scroll to the new round
                debateRounds.children[currentRound].scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Initialize
        init();
    </script>
</body>
</html>